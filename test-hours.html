<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Test Gi·ªù C√¥ng - MIA Schedule</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
      }
      button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        display: block;
        margin: 20px auto;
      }
      button:hover {
        background: #45a049;
      }
      #results {
        margin-top: 30px;
        padding: 20px;
        background: #f9f9f9;
        border-radius: 5px;
        font-family: monospace;
        white-space: pre-wrap;
        line-height: 1.5;
      }
      .success {
        color: #4caf50;
        font-weight: bold;
      }
      .warning {
        color: #ff9800;
        font-weight: bold;
      }
      .error {
        color: #f44336;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ Test C√¢n B·∫±ng Gi·ªù C√¥ng</h1>
      <p style="text-align: center; color: #666">
        Ki·ªÉm tra thu·∫≠t to√°n ph√¢n chia ca ƒë·∫£m b·∫£o 208h/th√°ng
      </p>

      <button onclick="runTest()">Ch·∫°y Test</button>

      <div id="results"></div>
    </div>

    <script type="module">
      import { ScheduleManager } from "./src/js/schedule.js";
      import { CONFIG } from "./src/js/config.js";

      window.runTest = async function () {
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = "‚è≥ ƒêang ch·∫°y test...\n\n";

        try {
          // Test for current month
          const now = new Date();
          const month = now.getMonth() + 1;
          const year = now.getFullYear();

          resultsDiv.innerHTML += `üìÖ Test th√°ng ${month}/${year}\n`;
          resultsDiv.innerHTML += "‚îÅ".repeat(50) + "\n\n";

          // Create schedule
          const scheduleManager = new ScheduleManager();
          const schedule = scheduleManager.generateSchedule(month, year);

          // Calculate stats
          const stats = scheduleManager.calculateEmployeeStats();

          // Display results
          resultsDiv.innerHTML += "üë• K·∫æT QU·∫¢ PH√ÇN CHIA GI·ªú C√îNG:\n\n";

          let allMeetTarget = true;
          const target = CONFIG.employees.targetHours;

          CONFIG.employees.list.forEach((employee) => {
            const stat = stats[employee];
            const totalHours =
              stat.regularHours +
              stat.overtimeHours / CONFIG.multipliers.overtime +
              stat.holidayHours / CONFIG.multipliers.holiday;

            const difference = totalHours - target;
            const percentComplete = ((totalHours / target) * 100).toFixed(1);

            let status = "‚úÖ";
            let cssClass = "success";

            if (Math.abs(difference) > 2) {
              allMeetTarget = false;
              status = difference < 0 ? "‚ùå" : "‚ö†Ô∏è";
              cssClass = difference < 0 ? "error" : "warning";
            }

            resultsDiv.innerHTML += `${status} ${employee}: `;
            resultsDiv.innerHTML += `<span class="${cssClass}">${totalHours.toFixed(1)}h</span>`;
            resultsDiv.innerHTML += ` / ${target}h (${percentComplete}%)\n`;
            resultsDiv.innerHTML += `   - Gi·ªù th∆∞·ªùng: ${stat.regularHours.toFixed(1)}h\n`;
            resultsDiv.innerHTML += `   - TƒÉng ca: ${(stat.overtimeHours / CONFIG.multipliers.overtime).toFixed(1)}h\n`;
            resultsDiv.innerHTML += `   - Ng√†y l·ªÖ: ${(stat.holidayHours / CONFIG.multipliers.holiday).toFixed(1)}h\n`;
            resultsDiv.innerHTML += `   - Ng√†y ngh·ªâ: ${stat.restDays.length} ng√†y\n`;
            resultsDiv.innerHTML += "\n";
          });

          resultsDiv.innerHTML += "‚îÅ".repeat(50) + "\n\n";

          // Summary
          const avgHours =
            Object.values(stats).reduce((sum, stat) => {
              return (
                sum +
                stat.regularHours +
                stat.overtimeHours / CONFIG.multipliers.overtime +
                stat.holidayHours / CONFIG.multipliers.holiday
              );
            }, 0) / CONFIG.employees.list.length;

          resultsDiv.innerHTML += "üìä T·ªîNG K·∫æT:\n";
          resultsDiv.innerHTML += `- Gi·ªù trung b√¨nh: ${avgHours.toFixed(1)}h\n`;
          resultsDiv.innerHTML += `- Target: ${target}h\n`;
          resultsDiv.innerHTML += `- ƒê·ªô l·ªách: ${Math.abs(avgHours - target).toFixed(1)}h\n\n`;

          if (allMeetTarget) {
            resultsDiv.innerHTML +=
              '<span class="success">‚úÖ T·∫§T C·∫¢ NH√ÇN VI√äN ƒê·∫†T TARGET!</span>\n';
          } else {
            resultsDiv.innerHTML +=
              '<span class="warning">‚ö†Ô∏è M·ªôt s·ªë nh√¢n vi√™n ch∆∞a ƒë·∫°t target 208h</span>\n';
            resultsDiv.innerHTML += "Thu·∫≠t to√°n c·∫ßn ti·∫øp t·ª•c t·ªëi ∆∞u.\n";
          }

          // Check console for detailed log
          resultsDiv.innerHTML += "\nüí° M·ªü Console (F12) ƒë·ªÉ xem log chi ti·∫øt.";
        } catch (error) {
          resultsDiv.innerHTML =
            '<span class="error">‚ùå L·ªói: ' + error.message + "</span>";
          console.error(error);
        }
      };
    </script>
  </body>
</html>
